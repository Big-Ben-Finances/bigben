<html><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Big Ben</title>
    <link href="/bigben/scripts/style.css" rel="stylesheet" type="text/css">
    <link rel="shortcut icon" href="/bigben/images/big ben.png">
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@500&amp;display=swap" rel="stylesheet">
  <script>
  function goSomewhere(x){
window.location = x;
}
function startOff(){
if(localStorage.getItem("loggedIn") == "true"){
document.getElementById("changeToName").innerHTML = "<h2 class='text' style='float:right;'>"+localStorage.getItem('username')+"</h2><button class='loginandsignupconfirm' onclick='reset()' style='float:right;background-color:rgb(115,243,195);'>Log out</button><button class='loginandsignupconfirm' onclick='goSomewhere(\"profile.html\")' style='float:right;background-color:rgb(115,243,195);'>Profile</button>";
}
}
  </script></head>
   
  <body onload="startOff()">
    <script src="/bigben/scripts/script.js"></script>
    <div class="header">
      <a href="/bigben/signup.html" class="text" style="float: right; font-size: 20px;">Signup</a><a href="/bigben/login.html" class="text" style="float: right; font-size: 20px; padding-right: 15px;">Login</a><a href="index.html" style="text-decoration:none;"><p class="text" style="margin:0px;font-size:30px;padding:10px;">BigBen</p></a>
    </div>
    <center>
    

    <div style="display:inline-block;padding-top:160px;">
<form id="sign-in-form">
    <p class="text" style="font-size:20px;margin:0px;color: #3090C7;">Username</p>

    <input type="text" style="color:grey;" class="textinput" id="username">

<br>
<br>
<br><br>
    <p class="text" style="font-size:20px;margin:0px;color: #3090C7;">Password</p>

    <input type="password" style="color:grey;" class="textinput" id="password">
<br><br>
        <button class="loginandsignupconfirm" type="submit">login</button>
    </form><br><br>
<p class="text" id="warner" style="color:red;"></p>
<a href="#" class="text" style="text-decoration: none;color: #3090C7">forgot password</a></div>
    <br>
    <br>
    <br>
    </center>
<script src="https://www.gstatic.com/firebasejs/7.14.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.0/firebase-firestore.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
<script>

  var firebaseConfig = {
    apiKey: "AIzaSyAcPOlFIiQZz8V9flKVbLA7TaYs1Q6_AWs",
    authDomain: "bigben-finances.firebaseapp.com",
    databaseURL: "https://bigben-finances.firebaseio.com",
    projectId: "bigben-finances",
    storageBucket: "bigben-finances.appspot.com",
    messagingSenderId: "1046658245162",
    appId: "1:1046658245162:web:083464e0dded0950fa1953",
    measurementId: "G-24YR5YR7K3"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>
<script>
const form = document.querySelector('#sign-in-form');
form.addEventListener('submit', function (event) {
  event.preventDefault();
  const username = document.querySelector('#username').value;
  const password = document.querySelector('#password').value;
  
  const hashedPW = CryptoJS.SHA256(password).toString();
  db.collection("users")
  .where("username","==",username)
  .where("password","==",hashedPW)
  .get()
  .then(function(snapshot){
    if(snapshot.empty){
     document.querySelector("#warner").innerHTML = "Couldn't Find User. Try Again"; 
    }
    else{
      const user = snapshot.docs[0];
      console.log(user.id,user.data());
      localStorage.setItem("userToken",user.id);
      location = "lesson.html";
    }
  });

});
</script>
</body></html>
