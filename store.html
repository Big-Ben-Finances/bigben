function addCommas(nStr){
 nStr += '';
 var x = nStr.split('.');
 var x1 = x[0];
 var x2 = x.length > 1 ? '.' + x[1] : '';
 var rgx = /(\d+)(\d{3})/;
 while (rgx.test(x1)) {
  x1 = x1.replace(rgx, '$1' + ',' + '$2');
 }
 return x1 + x2;
}
const userToken = localStorage.getItem("userToken");
const shop = document.querySelector('.shop');
db.collection('shop')
.get()
.then(function(snapshot){
for(let doc of snapshot.docs){
const product = doc.data();
const productId = doc.id;
const a = document.createElement("a")

const br = document.createElement("br");

const div = document.createElement('div');
div.style['border'] = "5px solid rgb(201,247,200)";
div.style['border-radius'] = "10px";
div.style['padding'] = "5px";
div.style['width'] = "500px";
div.style['margin'] = "30px";

const divName = document.createElement('h2')
divName.className = "text";
divName.textContent = product.name;
divName.classList.add('name')
div.appendChild(divName)

const divPrice = document.createElement('p')
divPrice.className = "text";
divPrice.textContent = "Price: $"+addCommas(product.price);
divPrice.classList.add('price')
div.appendChild(divPrice)

const divRoi = document.createElement('p')
divRoi.className = "text";
divRoi.textContent = "Return on Investment: "+product.roi+"%";
divRoi.classList.add('roi')
div.appendChild(divRoi)

a.appendChild(div)

a.classList.add('product')
a.addEventListener('click',function(event){
  event.preventDefault()
  const data = {
    productId: productId,
    userToken: userToken
  }
  console.log(data)
  const purchaseUrl = "https://us-central1-bigben-finances.cloudfunctions.net/comfirmPurchase";
  fetch(purchaseUrl,{
    method: 'POST',
    mode: 'cors',
    headers:{
      'Content-Type':'application/json'
    },
    body: JSON.stringify(data)
  })
  .then(response => response.json())
  .then(data => console.log(data))
  .catch(error => console.log(error))
})
shop.appendChild(a)
}
})
